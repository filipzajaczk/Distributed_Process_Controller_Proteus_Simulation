C51 COMPILER V9.60.7.0   SILNIK                                                            02/23/2026 17:48:18 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE SILNIK
OBJECT MODULE PLACED IN .\Objects\silnik.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE silnik.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\si
                    -lnik.lst) TABS(2) OBJECT(.\Objects\silnik.obj)

line level    source

   1          #include <REGX52.H>
   2          
   3          //adresy urzadzen
   4          #define KLAWIATURA  0xF0
   5          #define LCD     0xE0
   6          #define BCD     0xD0
   7          #define SILNIK  0xB0
   8          
   9          //komendy
  10          #define OBROTY  0x01
  11          #define MOC  0x02
  12          #define KIERUNEK      0x03
  13          #define GRZANIE_L1    0x04
  14          #define GRZANIE_L2    0x05
  15          #define START         0x06
  16          #define MENU          0x07
  17          #define POKAZ_MENU    0x08
  18          
  19          volatile unsigned char obroty_licznik = 0;
  20          volatile unsigned char licznik = 0;
  21          volatile unsigned char lampa1 = 0;
  22          volatile unsigned char lampa2 = 0;
  23          volatile unsigned char moc_silnika = 50;
  24          
  25          volatile bit odebrano_nowy_pakiet = 0;
  26          volatile unsigned char odebrana_komenda = 0;
  27          volatile unsigned char odebrana_dana = 0;
  28          
  29          volatile bit aktualizuj_bcd = 0;
  30          volatile bit koniec = 0;
  31          bit lewo = 1;
  32          bit prawo = 0;
  33          
  34          void Send(unsigned char Value){
  35   1        ES = 0;
  36   1        P3_4 = 1;
  37   1        TI = 0; 
  38   1        SBUF = Value;
  39   1        while(TI==0){;}
  40   1        TI = 0;
  41   1        P3_4 = 0;
  42   1        ES = 1;
  43   1      }
  44          
  45          void wyslij_pakiet(unsigned char adresat, unsigned char komenda, unsigned int dana) {
  46   1        unsigned char pakiet1;
  47   1        pakiet1 = adresat | komenda;
  48   1        Send(pakiet1);
  49   1        Send(dana);
  50   1      }
  51          //zainicjowany jest licznik który tyka sobie w tle ale ograniczamy go do modulo 10. Moc okreslamy jako ula
             -mek
  52          //np. na 3 z 10 tykniec ma byc dostarczany prad do zarówy, w taki sposób dostarczamy 30% mocy zarowki
  53          void zarowa() interrupt 1
C51 COMPILER V9.60.7.0   SILNIK                                                            02/23/2026 17:48:18 PAGE 2   

  54          {
  55   1        
  56   1        TH0 = 0xFF;
  57   1        TL0 = 0x00;
  58   1        
  59   1        licznik++;
  60   1        if(licznik >= 100) licznik = 0;
  61   1        
  62   1        if(licznik < lampa1) P2_2 =1;
  63   1        else P2_2 = 0;
  64   1        
  65   1        if(licznik < lampa2) P2_1 =1;
  66   1        else P2_1 = 0;
  67   1        
  68   1        if(prawo && (licznik < moc_silnika)) P2_5 =1;
  69   1        else P2_5 = 0;
  70   1        
  71   1        if(lewo && (licznik < moc_silnika)) P2_6 =1;
  72   1        else P2_6 = 0;
  73   1      }
  74          
  75          //przy kazdym impulsie na port P3.2 (INT0) wykonuje sie ta funkcja zliczania obrotów
  76          void licz_obroty(void) interrupt 0 
  77          {
  78   1        obroty_licznik --;
  79   1        if (obroty_licznik > 0)
  80   1        {
  81   2          aktualizuj_bcd = 1;
  82   2        }
  83   1        
  84   1        if (obroty_licznik == 0)
  85   1        {
  86   2          P2_3 = 0;
  87   2          P2_4 = 0;
  88   2        }
  89   1      }
  90          
  91          
  92          void odebranie() interrupt 4
  93          {
  94   1        static unsigned char czekam = 0;
  95   1        static unsigned char temp = 0;
  96   1        unsigned char bajt;
  97   1        
  98   1        if(RI)
  99   1        {
 100   2          bajt = SBUF;
 101   2          RI = 0;
 102   2          
 103   2          if (czekam == 0) 
 104   2          {
 105   3            if ((bajt & 0xF0) == SILNIK)
 106   3            {
 107   4              temp = bajt & 0x0F;
 108   4              czekam = 1;
 109   4            }
 110   3          }
 111   2          else
 112   2          {
 113   3            odebrana_komenda = temp;
 114   3            odebrana_dana = bajt;
 115   3            odebrano_nowy_pakiet = 1;
C51 COMPILER V9.60.7.0   SILNIK                                                            02/23/2026 17:48:18 PAGE 3   

 116   3            czekam = 0;
 117   3          }
 118   2        }
 119   1          
 120   1      }
 121          
 122          
 123          void init()
 124          {
 125   1          TMOD = 0x21;
 126   1          TH1 = 0xFD;
 127   1          TL1 = 0xFD;
 128   1          SCON = 0x50;
 129   1          TR1 = 1;
 130   1          TH0 = 0xFF;
 131   1          TL0 = 0x9C;
 132   1          ET0 = 1;
 133   1          TR0 = 1;
 134   1      
 135   1          IT0 = 1;
 136   1          EX0 = 1;
 137   1          
 138   1          ES = 1;
 139   1          EA = 1;
 140   1      }
 141          
 142          void main(void)
 143          {
 144   1        init();
 145   1        
 146   1        P3_4 = 0;
 147   1        P2 = 0;
 148   1      
 149   1        P2_3 = 0;
 150   1        P2_4 = 0;
 151   1        
 152   1        
 153   1        while (1)
 154   1        {
 155   2          if (odebrano_nowy_pakiet)
 156   2          {
 157   3            switch(odebrana_komenda)
 158   3            {
 159   4              case OBROTY:
 160   4                obroty_licznik = odebrana_dana;
 161   4              break;
 162   4              case MOC:
 163   4                moc_silnika = odebrana_dana;
 164   4              break;
 165   4              case KIERUNEK:
 166   4                if(odebrana_dana == 1)
 167   4                {
 168   5                  lewo = 1;
 169   5                  prawo = 0;
 170   5                }
 171   4                else{
 172   5                  lewo = 0;
 173   5                  prawo = 1;
 174   5                }
 175   4              break;
 176   4              case GRZANIE_L1:
 177   4                lampa2 = odebrana_dana;
C51 COMPILER V9.60.7.0   SILNIK                                                            02/23/2026 17:48:18 PAGE 4   

 178   4              break;        
 179   4              case GRZANIE_L2:
 180   4                lampa1 = odebrana_dana;
 181   4              break;        
 182   4              case START:
 183   4                P2_3 = 1;
 184   4                P2_4 = 1;
 185   4              break;  
 186   4            }
 187   3            odebrano_nowy_pakiet = 0;
 188   3          }
 189   2          
 190   2          if(aktualizuj_bcd) 
 191   2          {
 192   3            wyslij_pakiet(BCD, OBROTY, obroty_licznik);
 193   3            aktualizuj_bcd = 0;
 194   3          }
 195   2        }
 196   1        
 197   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    333    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      5    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
